{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacaoController","selector","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordemAtual","_listaNegociacoes","Bind","ListaNegociacoes","NegociacoesView","_mensagem","Mensagem","MensagemView","_service","NegociacaoService","_init","listar","then","negociacoes","forEach","adicionar","negociacao","catch","texto","error","setInterval","importaNegociacoes","event","preventDefault","_criarNegociacao","msg","_limpaFormulario","removerTodas","esvaziar","importarDaAPI","coluna","inverteOrdem","ordena","a","b","Negociacao","DateHelper","textToDate","value","parseInt","parseFloat","focus"],"mappings":";;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;IAEMA,oB;AAEL,iCAAc;AAAA;;AAEb;AACA,MAAIC,WAAWC,SAASC,aAAT,CAAuBC,IAAvB,CAA4BF,QAA5B,CAAf;;AAEA,OAAKG,UAAL,GAAkBJ,SAAS,OAAT,CAAlB;AACA,OAAKK,gBAAL,GAAwBL,SAAS,aAAT,CAAxB;AACA,OAAKM,WAAL,GAAmBN,SAAS,QAAT,CAAnB;;AAEA;AACA;AACA;AACA,OAAKO,WAAL,GAAmB,EAAnB;;AAEA;AACA,OAAKC,iBAAL,GAAyB,IAAIC,UAAJ,CACxB,IAAIC,kCAAJ,EADwB,EAExB,IAAIC,gCAAJ,CAAoBX,SAAS,kBAAT,CAApB,CAFwB,EAGxB,WAHwB,EAGX,UAHW,EAGC,QAHD,EAGW,cAHX,CAAzB;;AAMA,OAAKY,SAAL,GAAiB,IAAIH,UAAJ,CAChB,IAAII,kBAAJ,EADgB,EAEhB,IAAIC,0BAAJ,CAAiBd,SAAS,eAAT,CAAjB,CAFgB,EAGhB,OAHgB,CAAjB;;AAMA;AACA,OAAKe,QAAL,GAAgB,IAAIC,oCAAJ,EAAhB;;AAEA,OAAKC,KAAL;AAEA;;;;0BAEO;AAAA;;AAEP;AACA,QAAKF,QAAL,CAAcG,MAAd,GACGC,IADH,CACQ;AAAA,WACLC,YAAYC,OAAZ,CAAoB;AAAA,YACnB,MAAKb,iBAAL,CAAuBc,SAAvB,CAAiCC,UAAjC,CADmB;AAAA,KAApB,CADK;AAAA,IADR,EAMEC,KANF,CAMQ;AAAA,WAAS,MAAKZ,SAAL,CAAea,KAAf,GAAuBC,KAAhC;AAAA,IANR;;AAQA;AACAC,eAAY,YAAM;;AAEjB,UAAKC,kBAAL;AAEA,IAJD,EAIG,IAJH;AAMA;;;2BAEQC,K,EAAO;AAAA;;AAEfA,SAAMC,cAAN;;AAEA;AACA,OAAIP,aAAa,KAAKQ,gBAAL,EAAjB;;AAEA;AACA,QAAKhB,QAAL,CAAcO,SAAd,CAAwBC,UAAxB,EACEJ,IADF,CACO,UAACa,GAAD,EAAS;AACd,WAAKxB,iBAAL,CAAuBc,SAAvB,CAAiCC,UAAjC;AACA,WAAKX,SAAL,CAAea,KAAf,GAAuBO,GAAvB;AACA,WAAKC,gBAAL;AACA,IALF,EAMET,KANF,CAMQ;AAAA,WAAS,OAAKZ,SAAL,CAAea,KAAf,GAAuBC,KAAhC;AAAA,IANR;AAQA;;;2BAEQ;AAAA;;AAER;AACA,QAAKX,QAAL,CAAcmB,YAAd,GACEf,IADF,CACO,UAACa,GAAD,EAAS;AACd,WAAKxB,iBAAL,CAAuB2B,QAAvB;AACA,WAAK3B,iBAAL,CAAuBiB,KAAvB,GAA+BO,GAA/B;AACA,IAJF,EAKER,KALF,CAKQ;AAAA,WAAS,OAAKZ,SAAL,CAAea,KAAf,GAAuBC,KAAhC;AAAA,IALR;AAOA;;;uCAEoB;AAAA;;AAEpB;AACA;AACA;;AAEA,QAAKX,QAAL,CAAcqB,aAAd,CAA4B,KAAK5B,iBAAjC,EACEW,IADF,CACO,uBAAe;AACpBC,gBAAYC,OAAZ,CAAoB,sBAAc;AACjC,YAAKb,iBAAL,CAAuBc,SAAvB,CAAiCC,UAAjC;AACA,KAFD;AAGA,IALF,EAMEC,KANF,CAMQ;AAAA,WAAS,OAAKZ,SAAL,CAAea,KAAf,GAAuBC,KAAhC;AAAA,IANR;AAQA;;;yBAEMW,M,EAAQ;;AAEd,OAAG,KAAK9B,WAAL,IAAoB8B,MAAvB,EAA+B;AAC9B,SAAK7B,iBAAL,CAAuB8B,YAAvB;AACA,IAFD,MAEO;AACN,SAAK9B,iBAAL,CAAuB+B,MAAvB,CAA8B,UAACC,CAAD,EAAIC,CAAJ;AAAA,YAAUD,EAAEH,MAAF,IAAYI,EAAEJ,MAAF,CAAtB;AAAA,KAA9B;AACA;;AAED,QAAK9B,WAAL,GAAmB8B,MAAnB;AAEA;;;qCAEkB;;AAElB,UAAO,IAAIK,sBAAJ,CACNC,uBAAWC,UAAX,CAAsB,KAAKxC,UAAL,CAAgByC,KAAtC,CADM,EAENC,SAAS,KAAKzC,gBAAL,CAAsBwC,KAA/B,CAFM,EAGNE,WAAW,KAAKzC,WAAL,CAAiBuC,KAA5B,CAHM,CAAP;AAMA;;;qCAEkB;;AAElB,QAAKzC,UAAL,CAAgByC,KAAhB,GAAwB,EAAxB;AACA,QAAKxC,gBAAL,CAAsBwC,KAAtB,GAA8B,CAA9B;AACA,QAAKvC,WAAL,CAAiBuC,KAAjB,GAAyB,GAAzB;;AAEA,QAAKzC,UAAL,CAAgB4C,KAAhB;AAEA","file":"NegociacaoController.js","sourcesContent":["import { ListaNegociacoes } from \"../models/ListaNegociacoes\";\r\nimport { Mensagem } from \"../models/Mensagem\";\r\nimport { Negociacao } from \"../models/Negociacao\";\r\nimport { NegociacoesView } from \"../views/NegociacoesView\";\r\nimport { MensagemView } from \"../views/MensagemView\";\r\nimport { NegociacaoService } from \"../services/NegociacaoService\";\r\nimport { DateHelper } from \"../helpers/DateHelper\";\r\nimport { Bind } from \"../helpers/Bind\";\r\n\r\nclass NegociacaoController {\r\n\r\n\tconstructor() {\r\n\r\n\t\t// um alias igual existe o $ do JQuery\r\n\t\tlet selector = document.querySelector.bind(document);\r\n\r\n\t\tthis._inputData = selector(\"#data\");\r\n\t\tthis._inputQuantidade = selector(\"#quantidade\");\r\n\t\tthis._inputValor = selector(\"#valor\");\r\n\r\n\t\t//this._listaNegociacoes = new ListaNegociacoes(model => \t\t\r\n\t\t//\tthis._negociacoesView.update(model)\r\n\t\t//);\r\n\t\tthis._ordemAtual = '';\r\n\r\n\t\t//Tecnica de data binding (associação de dados)\r\n\t\tthis._listaNegociacoes = new Bind(\r\n\t\t\tnew ListaNegociacoes(),\r\n\t\t\tnew NegociacoesView(selector(\"#NegociacoesView\")),\r\n\t\t\t'adicionar', 'esvaziar', 'ordena', 'inverteOrdem'\r\n\t\t);\r\n\r\n\t\tthis._mensagem = new Bind(\r\n\t\t\tnew Mensagem(),\r\n\t\t\tnew MensagemView(selector(\"#MensagemView\")),\r\n\t\t\t'texto'\r\n\t\t);\r\n\r\n\t\t// API for trades\r\n\t\tthis._service = new NegociacaoService();\r\n\r\n\t\tthis._init();\r\n\r\n\t}\r\n\r\n\t_init() {\r\n\r\n\t\t// lists all trades stored locally\r\n\t\tthis._service.listar()\r\n\t\t\t\t.then(negociacoes => \r\n\t\t\t\t\tnegociacoes.forEach(negociacao =>\r\n\t\t\t\t\t\tthis._listaNegociacoes.adicionar(negociacao)\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\t.catch(error => this._mensagem.texto = error);\r\n\r\n\t\t// Set a Time interval to import negotiations\r\n\t\tsetInterval(() => {\r\n\r\n\t\t\tthis.importaNegociacoes();\r\n\r\n\t\t}, 5000);\r\n\r\n\t}\r\n\r\n\tadiciona(event) {\r\n\t\t\r\n\t\tevent.preventDefault();\t\r\n\r\n\t\t// new trade created\r\n\t\tlet negociacao = this._criarNegociacao();\r\n\r\n\t\t// adding trade using API\r\n\t\tthis._service.adicionar(negociacao)\r\n\t\t\t.then((msg) => {\r\n\t\t\t\tthis._listaNegociacoes.adicionar(negociacao);\r\n\t\t\t\tthis._mensagem.texto = msg;\r\n\t\t\t\tthis._limpaFormulario();\r\n\t\t\t})\r\n\t\t\t.catch(error => this._mensagem.texto = error);\t\t\r\n\r\n\t}\r\n\r\n\tapagar() {\r\n\r\n\t\t// clean all trades on list of trades\r\n\t\tthis._service.removerTodas()\r\n\t\t\t.then((msg) => {\r\n\t\t\t\tthis._listaNegociacoes.esvaziar();\r\n\t\t\t\tthis._listaNegociacoes.texto = msg;\r\n\t\t\t})\r\n\t\t\t.catch(error => this._mensagem.texto = error);\r\n\r\n\t}\r\n\r\n\timportaNegociacoes() {\r\n\r\n\t\t// o motivo de usar let:\r\n\t\t// usamos var quando queremos que a variável tenha escopo global ou de função\r\n\t\t// usarmos let quando queremos que a variável tenha sempre escopo de bloco. \r\n\r\n\t\tthis._service.importarDaAPI(this._listaNegociacoes)\r\n\t\t\t.then(negociacoes => {\r\n\t\t\t\tnegociacoes.forEach(negociacao => {\r\n\t\t\t\t\tthis._listaNegociacoes.adicionar(negociacao);\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\t.catch(error => this._mensagem.texto = error);\t\r\n\t\r\n\t}\r\n\r\n\tordena(coluna) {\r\n\r\n\t\tif(this._ordemAtual == coluna) {\r\n\t\t\tthis._listaNegociacoes.inverteOrdem();\r\n\t\t} else {\r\n\t\t\tthis._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\r\n\t\t}\r\n\r\n\t\tthis._ordemAtual = coluna;\r\n\r\n\t}\r\n\r\n\t_criarNegociacao() {\r\n\r\n\t\treturn new Negociacao (\r\n\t\t\tDateHelper.textToDate(this._inputData.value),\r\n\t\t\tparseInt(this._inputQuantidade.value),\r\n\t\t\tparseFloat(this._inputValor.value)\r\n\t\t);\r\n\r\n\t}\r\n\r\n\t_limpaFormulario() {\r\n\r\n\t\tthis._inputData.value = \"\";\r\n\t\tthis._inputQuantidade.value = 1;\r\n\t\tthis._inputValor.value = 0.0;\r\n\r\n\t\tthis._inputData.focus();\r\n\r\n\t}\r\n\r\n}"]}