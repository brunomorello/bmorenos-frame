{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","Negociacao","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","NegociacaoController","selector","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordemAtual","_listaNegociacoes","_mensagem","_service","_init","listar","then","negociacoes","forEach","adicionar","negociacao","catch","texto","error","setInterval","importaNegociacoes","event","preventDefault","_criarNegociacao","msg","_limpaFormulario","removerTodas","esvaziar","importarDaAPI","coluna","inverteOrdem","ordena","a","b","textToDate","value","parseInt","parseFloat","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { ListaNegociacoes } from \"../models/ListaNegociacoes\";\r\nimport { Mensagem } from \"../models/Mensagem\";\r\nimport { Negociacao } from \"../models/Negociacao\";\r\nimport { NegociacoesView } from \"../views/NegociacoesView\";\r\nimport { MensagemView } from \"../views/MensagemView\";\r\nimport { NegociacaoService } from \"../services/NegociacaoService\";\r\nimport { DateHelper } from \"../helpers/DateHelper\";\r\nimport { Bind } from \"../helpers/Bind\";\r\n\r\nexport class NegociacaoController {\r\n\r\n\tconstructor() {\r\n\r\n\t\t// um alias igual existe o $ do JQuery\r\n\t\tlet selector = document.querySelector.bind(document);\r\n\r\n\t\tthis._inputData = selector(\"#data\");\r\n\t\tthis._inputQuantidade = selector(\"#quantidade\");\r\n\t\tthis._inputValor = selector(\"#valor\");\r\n\r\n\t\t//this._listaNegociacoes = new ListaNegociacoes(model => \t\t\r\n\t\t//\tthis._negociacoesView.update(model)\r\n\t\t//);\r\n\t\tthis._ordemAtual = '';\r\n\r\n\t\t//Tecnica de data binding (associação de dados)\r\n\t\tthis._listaNegociacoes = new Bind(\r\n\t\t\tnew ListaNegociacoes(),\r\n\t\t\tnew NegociacoesView(selector(\"#NegociacoesView\")),\r\n\t\t\t'adicionar', 'esvaziar', 'ordena', 'inverteOrdem'\r\n\t\t);\r\n\r\n\t\tthis._mensagem = new Bind(\r\n\t\t\tnew Mensagem(),\r\n\t\t\tnew MensagemView(selector(\"#MensagemView\")),\r\n\t\t\t'texto'\r\n\t\t);\r\n\r\n\t\t// API for trades\r\n\t\tthis._service = new NegociacaoService();\r\n\r\n\t\tthis._init();\r\n\r\n\t}\r\n\r\n\t_init() {\r\n\r\n\t\t// lists all trades stored locally\r\n\t\tthis._service.listar()\r\n\t\t\t\t.then(negociacoes => \r\n\t\t\t\t\tnegociacoes.forEach(negociacao =>\r\n\t\t\t\t\t\tthis._listaNegociacoes.adicionar(negociacao)\r\n\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\t.catch(error => this._mensagem.texto = error);\r\n\r\n\t\t// Set a Time interval to import negotiations\r\n\t\tsetInterval(() => {\r\n\r\n\t\t\tthis.importaNegociacoes();\r\n\r\n\t\t}, 5000);\r\n\r\n\t}\r\n\r\n\tadiciona(event) {\r\n\t\t\r\n\t\tevent.preventDefault();\t\r\n\r\n\t\t// new trade created\r\n\t\tlet negociacao = this._criarNegociacao();\r\n\r\n\t\t// adding trade using API\r\n\t\tthis._service.adicionar(negociacao)\r\n\t\t\t.then((msg) => {\r\n\t\t\t\tthis._listaNegociacoes.adicionar(negociacao);\r\n\t\t\t\tthis._mensagem.texto = msg;\r\n\t\t\t\tthis._limpaFormulario();\r\n\t\t\t})\r\n\t\t\t.catch(error => this._mensagem.texto = error);\t\t\r\n\r\n\t}\r\n\r\n\tapagar() {\r\n\r\n\t\t// clean all trades on list of trades\r\n\t\tthis._service.removerTodas()\r\n\t\t\t.then((msg) => {\r\n\t\t\t\tthis._listaNegociacoes.esvaziar();\r\n\t\t\t\tthis._listaNegociacoes.texto = msg;\r\n\t\t\t})\r\n\t\t\t.catch(error => this._mensagem.texto = error);\r\n\r\n\t}\r\n\r\n\timportaNegociacoes() {\r\n\r\n\t\t// o motivo de usar let:\r\n\t\t// usamos var quando queremos que a variável tenha escopo global ou de função\r\n\t\t// usarmos let quando queremos que a variável tenha sempre escopo de bloco. \r\n\r\n\t\tthis._service.importarDaAPI(this._listaNegociacoes)\r\n\t\t\t.then(negociacoes => {\r\n\t\t\t\tnegociacoes.forEach(negociacao => {\r\n\t\t\t\t\tthis._listaNegociacoes.adicionar(negociacao);\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\t.catch(error => this._mensagem.texto = error);\t\r\n\t\r\n\t}\r\n\r\n\tordena(coluna) {\r\n\r\n\t\tif(this._ordemAtual == coluna) {\r\n\t\t\tthis._listaNegociacoes.inverteOrdem();\r\n\t\t} else {\r\n\t\t\tthis._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\r\n\t\t}\r\n\r\n\t\tthis._ordemAtual = coluna;\r\n\r\n\t}\r\n\r\n\t_criarNegociacao() {\r\n\r\n\t\treturn new Negociacao (\r\n\t\t\tDateHelper.textToDate(this._inputData.value),\r\n\t\t\tparseInt(this._inputQuantidade.value),\r\n\t\t\tparseFloat(this._inputValor.value)\r\n\t\t);\r\n\r\n\t}\r\n\r\n\t_limpaFormulario() {\r\n\r\n\t\tthis._inputData.value = \"\";\r\n\t\tthis._inputQuantidade.value = 1;\r\n\t\tthis._inputValor.value = 0.0;\r\n\r\n\t\tthis._inputData.focus();\r\n\r\n\t}\r\n\r\n}"]}